push!(LOAD_PATH, "/home/guilhermebodin/Documents/Github/ScoreDrivenModels.jl/src")
using ScoreDrivenModels, Distributions, LinearAlgebra

using Test, Random



gas_sarima = GAS_Sarima(1, 1, Beta(), 0.0)
vect = 0.1*ones(length(params(Beta())))
gas_sarima.Ï‰ = vect
gas_sarima.A[1] = convert(Matrix{Float64}, Diagonal(5*vect))
gas_sarima.B[1] = convert(Matrix{Float64}, Diagonal(5*vect))  
gas_sarima
simulation, param_simulated = simulate(gas_sarima, 1000)

gas_sarima = GAS_Sarima(1, 1, Normal(), 0.0)
estimate_GAS_Sarima!(gas_sarima, simulation; verbose = 0,
                     random_seeds_lbfgs = ScoreDrivenModels.RandomSeedsLBFGS(5, ScoreDrivenModels.dim_unknowns(gas_sarima)))

gas_sarima
param = score_driven_recursion(gas_sarima, simulation)
param_simulated

include("test_recursion.jl")
include("test_estimate.jl")

serie = [0.249702, 0.194312, 0.792071, 0.907371, 0.539655, 0.0805991, 0.00197504, 0.281145, 0.519991, 0.824033, 0.860002, 0.962009, 0.858356, 0.83918, 0.97787, 0.688244, 0.320795, 0.102222, 0.031076, 0.0955763, 0.107468, 0.257681, 0.858795, 0.64595, 0.798162, 0.429363, 0.244773, 0.59607, 0.241622, 0.353103, 0.0482604, 0.207438, 0.237568, 0.145891, 0.00374581, 0.193576, 0.77538, 0.804164, 0.904805, 0.673273, 0.996044, 1.0, 0.999875, 0.626838, 0.370988, 0.00299922, 1.14386e-6, 0.000104025, 0.0286797, 0.111749, 0.117859, 0.201075, 0.528343, 0.569662, 0.827428, 0.994252, 0.978047, 0.986183, 0.815114, 0.977831, 0.877218, 0.367327, 0.0160401, 0.242584, 0.864306, 0.98548, 0.767279, 0.119308, 0.0391828, 0.131385, 0.88563, 0.999496, 0.84162, 0.748792, 0.692074, 0.238801, 0.0957513, 0.639858, 0.898153,0.629238, 0.485073, 0.549008, 0.218753, 0.219791, 0.263886, 0.660879, 0.458044, 0.00947129, 0.0613557, 0.451694, 0.282967, 0.391777, 0.66562, 0.887791, 0.946342, 0.831693, 0.692849, 0.167684, 0.0893225, 0.376622, 0.801735, 0.683846, 0.980349, 1.0, 0.994917, 0.834433, 0.566697, 0.543231, 0.860685, 0.981131, 0.741069, 0.105193, 0.0133888, 0.00774168, 0.0823468, 0.167106, 0.392944, 0.946932, 0.963495, 0.953229, 0.146719, 0.0003621, 0.035364, 0.286498, 0.934156, 0.883202, 0.471664, 0.178011, 0.218441, 0.166376, 0.480178, 0.344426, 0.407558, 0.732201, 0.122937, 0.0807452, 0.239394, 0.307337, 0.749138, 0.840357, 0.438935, 0.0442102, 0.0111003, 0.0330221, 0.00513819, 0.0222132, 0.165989, 0.849469, 0.890807, 0.577858, 0.00888778, 8.79526e-5, 0.00172616, 0.670035, 0.833911, 0.448037, 0.683148,0.697778, 0.473438, 0.665261, 0.766877, 0.41012, 0.476166, 0.0436563, 0.171719, 0.865925, 0.608731, 0.307243, 0.371351, 0.832879, 0.806799, 0.603193, 0.431181, 0.585804, 0.100243, 0.114534, 0.359866, 0.790506, 0.933429, 0.739702, 0.449543, 0.529906, 0.397094, 0.33829, 0.369937, 0.147144, 0.0725259, 0.631933, 0.793498, 0.853197, 0.890753, 0.904183, 0.707313, 0.766696, 0.949654, 0.645094, 0.526689, 0.832518, 0.860004, 0.859863, 0.324257, 0.118039, 0.206635, 0.00965457, 9.5133e-11, 0.263178, 0.190742, 0.162508, 0.0766049, 0.213439, 0.233633, 0.0116141, 0.0141063, 0.000766924, 0.0810763, 0.112538, 0.670357, 0.407971, 0.482748, 0.14947, 0.33244, 0.484481, 0.635395, 0.763399, 0.922853, 0.944506, 0.833227, 0.228973, 0.180088, 0.383267, 0.192783, 0.192313, 0.0380909, 0.105655, 0.0960807, 0.288942, 0.136014, 0.270106, 0.261936, 0.33398, 0.210252, 0.424694, 0.382723, 0.711, 0.608172, 0.203324, 0.33623, 0.0427149, 0.0680647, 0.397892, 0.0812562, 0.174564, 0.823548, 0.911917, 0.355223, 0.316344, 0.356273, 0.60382, 0.862436, 0.790055, 0.573358, 0.842498, 0.983844, 0.494544, 0.375171, 0.438268, 0.871629, 0.728259, 0.574675, 0.478239, 0.808891, 0.676346, 0.740064, 0.658312, 0.833781, 0.332332, 0.0188686, 0.282975, 0.342713, 0.757118, 0.550324, 0.899642, 0.846018, 0.4928, 0.336957, 0.227369, 0.501845, 0.464736, 0.01388, 0.00215354, 0.238683, 0.127781, 0.621274, 0.3021, 0.64596, 0.401552, 0.14219, 0.531954, 0.455905, 0.231684, 0.20172, 0.350066, 0.204173, 0.116374, 0.0214025, 0.377859, 0.0879366, 0.137599, 0.162193, 0.0348231, 0.552898, 0.497751, 0.313116, 0.127765, 0.18071, 0.329687, 0.428577, 0.0209294, 0.00352774, 0.122074, 0.141142, 0.174739, 0.011306, 0.00279581, 0.145723, 0.146137, 0.407266, 0.662867, 0.61713, 0.756207, 0.148265, 1.80835e-6, 0.0150885, 0.683403, 0.636242, 0.759671, 0.629879, 0.475412, 0.221282, 0.0865955, 0.144309, 0.881297, 0.999377, 0.99973, 0.99991, 0.999754, 0.999702, 0.619136, 0.847129, 0.893332, 0.961899, 0.918492, 0.490816, 0.0477261, 0.00908993, 0.0185838, 0.0191639, 0.5946, 0.375368, 0.840431, 0.853118, 0.398194, 0.42484, 0.741087, 0.527313, 0.545188, 0.296053, 0.230859, 0.582245, 0.21002, 0.0282982, 0.146729, 0.45114, 0.0468731, 0.00343015, 0.245308, 0.434895, 0.145493, 0.463609, 0.326787, 0.248242, 0.870528, 0.798287, 0.954244, 0.946113, 0.773099, 0.869344, 0.798217, 0.609837, 0.640626, 0.60343, 0.650299, 0.639351, 0.589337, 0.524797, 0.473899, 0.343123, 0.703362, 0.573795, 0.332016, 0.600382, 0.580078, 0.238137, 0.548621, 0.432613, 0.193837, 0.62199, 0.414716, 0.228748, 0.943522, 0.98248, 0.562385, 0.336635, 0.692748, 0.872018, 0.571206, 0.316557, 0.0734345, 0.0827708, 0.099467, 0.238593, 0.869086, 0.38954, 0.67518, 0.751636, 0.544312, 0.376363, 0.415439, 0.29407, 0.436848, 0.149685, 0.0347144, 0.0787296, 0.133879, 0.743307, 0.99676, 0.999999, 0.992536, 0.429905, 0.848618, 0.483815, 0.628204, 0.260678, 0.0101096, 0.00151395, 0.199704, 0.575667, 0.393912, 0.190631, 0.0268017, 0.246422, 0.453582, 0.143442, 0.159789, 0.0896883, 0.0265155, 0.002064, 0.00240281, 0.115984, 0.847101, 0.969697, 0.306808, 0.0681922, 0.244127, 0.0741751, 0.54229, 0.468786, 0.167239, 0.0671073, 0.327128, 0.837038, 0.988774, 0.794227, 0.234223, 0.146028, 0.163247, 0.518045, 0.710723, 0.493715, 0.425705, 0.239565, 0.158389, 0.280659, 0.371794, 0.481294, 0.738342, 0.754917, 0.895005, 0.812189, 0.577809, 0.580494, 0.581567, 0.924095, 1.0, 0.992566, 0.968784, 0.860291, 0.90832, 0.914774, 0.86007, 0.878049, 0.777395, 0.850842, 0.950827, 0.950563, 0.549796, 0.72969, 0.488821, 0.272495, 0.223358, 0.517833, 0.819177, 0.73732, 0.584999, 0.141881, 0.000856624, 0.0363312, 0.392492, 0.710961, 0.962619, 0.999635, 0.971504, 0.876899, 0.814604, 0.068824, 0.000705443, 0.0853025, 0.0153859, 0.0284083, 0.254938, 0.162471, 0.0836836, 0.420177, 0.410599, 0.307348, 0.481908, 0.175893, 0.162807, 0.476555, 0.128802, 0.0413715, 0.15063, 0.632412, 0.437303, 0.233439, 0.62187, 0.55279, 0.335767, 0.696693, 0.467406, 0.637438, 0.508072, 0.665729, 0.809347, 0.889989, 0.584295, 0.923846, 0.650296, 0.517164, 0.645682, 0.787039, 0.998297, 0.887614, 0.636034, 0.0560739, 0.0241607, 0.230445, 0.0775439, 0.00477879, 0.0118234, 0.176679, 0.121611, 0.591198, 0.342643, 0.399197, 0.586056, 0.535296, 0.29849, 0.829939, 0.985919, 0.898211, 0.154638, 0.307333, 0.492452, 0.368004, 0.770248, 0.975745, 0.993499, 0.990018, 0.853089, 0.415326, 0.547329, 0.17512, 0.0293388, 0.0119967, 0.00382043, 0.0120034, 0.0159051, 0.21436, 0.118845, 0.433345, 0.158826, 0.0531396, 0.0229289, 0.0494278, 0.655474, 0.938203, 0.289522, 1.26227e-5, 0.0017041, 0.508879,0.424972, 0.716678, 0.475477, 0.489774, 0.177419, 0.530981, 0.189949, 0.00545754, 0.010886, 0.0683234, 0.19815, 0.577044, 0.540608, 0.477704, 0.389403, 0.805809, 0.273408, 0.0813188, 0.588576, 0.69032, 0.869183, 0.475748, 0.325469, 0.449194, 0.0873686, 1.35684e-5, 3.22924e-5, 0.0156254, 0.463655, 0.502715, 0.84756, 0.279936, 0.273903, 0.583023, 0.37972, 0.0949789, 0.00109462, 0.0135632, 0.296906, 0.382697, 0.733644, 0.547253, 0.596536, 0.94349, 0.845284, 0.947438, 0.987278, 0.980667, 0.905661, 0.866059, 0.858056, 0.469634, 0.928719, 0.478828, 0.780712, 0.690239, 0.927655, 0.709641, 0.681357, 0.767927, 0.573712, 0.250156, 0.556533, 0.692324, 0.855969, 0.911797, 0.8276, 0.791826, 0.382642, 0.503933, 0.260241, 0.124473, 0.0207161, 0.0516108, 0.424, 0.617419, 0.613907, 0.768495, 0.446275,0.565794, 0.68003, 0.796564, 0.523917, 0.228173, 0.0345205, 0.289781, 0.79847, 0.973473, 0.999343, 0.733247, 0.245266, 0.213807, 0.525108, 0.552365, 0.226285, 0.566856, 0.755545, 0.476306, 0.633966,0.63722, 0.225315, 0.375198, 0.733298, 0.745327, 0.329447, 0.0242623, 0.419506, 0.0308465, 0.118837, 0.277487, 0.273443, 0.347315, 0.0806228, 0.00308749, 0.16584, 0.146104, 0.668985, 0.654343, 0.697648, 0.533048, 0.571804, 0.632009, 0.827742, 0.964707, 0.348499, 0.258736, 0.433286, 0.180988, 0.228092, 0.113148, 0.342924, 0.590182, 0.465043, 0.228985, 0.140648, 0.650367, 0.995852, 0.841303, 0.298405, 0.171792, 0.743969, 0.98399, 0.981322, 0.737372, 0.182322, 0.688169, 0.372518, 0.2739, 0.22712, 0.40831, 0.558279, 0.576323, 0.255102, 0.404061, 0.881609, 0.784664, 0.838796, 0.532319, 0.624043, 0.392241, 0.163291, 0.00285071, 0.212122, 0.0353905, 0.000345315, 2.30492e-7, 0.0388459, 0.021691, 0.000542198, 1.38397e-6, 0.038842, 0.0513899, 0.204594, 0.552938, 0.588663, 0.329781, 0.0590389, 0.0519668, 0.339841, 0.918625, 0.981989, 0.78054, 0.949525, 0.38297, 0.818598, 0.517752, 0.735743, 0.893302, 0.940603, 0.629347, 0.245598, 0.537115, 0.715945, 0.111963, 0.00213731, 0.0163522, 0.725042, 0.868348, 0.300589, 0.169692, 0.0799378, 0.0142749, 0.0131221, 0.0267255, 0.858977, 0.977789, 0.99138, 0.609395, 0.0527286, 0.00583394, 7.94697e-5, 6.92649e-6, 0.0134259, 0.0173668, 0.02826, 0.0494075, 0.400819, 0.435514, 0.732436, 0.970895, 0.546618, 0.302693, 0.331693, 0.705039, 0.218994, 0.00116027, 1.79029e-6, 8.76307e-5, 0.149574, 0.909503, 0.999796, 0.103147, 0.225546, 0.263916, 0.358513, 0.433992, 0.157325, 0.00562259, 0.0511425, 0.0324461, 0.34239, 0.806501, 0.655242, 0.458884, 0.251808, 0.389361, 0.714286, 0.252642, 0.0193811, 0.596821, 0.894457, 0.856768, 0.931656, 0.995862, 0.982683, 0.977886, 0.677028, 0.258779, 0.496673, 0.0953474, 0.130084, 0.379481, 0.508131, 0.782919, 0.236228, 0.0323097, 0.285942, 0.794673, 0.314891, 0.0590379, 0.0326385, 0.0323668, 0.332876, 0.478747, 0.322024, 0.353621, 0.570305, 0.619139, 0.359509, 0.900643, 0.999303, 0.984881, 0.573004, 0.242399, 0.551361, 0.708072, 0.657117, 0.267184, 0.111627, 0.889856, 0.564592, 0.815287, 0.187646, 0.0800372, 0.702579, 0.992068, 0.999991, 0.886601, 0.773772, 0.99054, 0.999958, 0.883637, 0.448966, 0.701522, 0.733302, 0.726815, 0.99046, 1.0, 0.997416, 0.678733, 0.950518, 0.986967, 0.770433, 0.394075, 0.173178, 0.169962, 0.0550312, 0.0679483, 0.0447664, 0.00476828, 0.0587222, 0.229165, 0.977847, 0.636497, 0.950986, 0.963535, 0.561145, 0.614948, 0.0524651, 0.0137722, 0.629962, 0.990498, 0.589539, 0.116044, 0.114205, 0.0189214, 0.805617, 0.858715, 0.859557, 0.897655, 0.995385, 0.999766, 0.343131, 0.0613686, 0.24723, 0.492011, 0.386696, 0.326029, 0.411837, 0.293091, 0.176628, 0.0287135, 0.037372,0.00672151, 0.00415083, 0.585402, 0.59996, 0.371056, 0.133157, 0.0568836, 0.29667, 0.47748, 0.796884, 0.311684, 0.0736789, 0.0263559, 0.0348515, 0.0108388, 0.097963, 0.73587, 0.93523, 0.666195, 0.412611, 0.895337, 0.66485, 0.53817, 0.936019, 0.940103, 0.827153, 0.589532, 0.237755, 0.183689, 0.344568, 0.23678, 0.422215, 0.610394, 0.0828518, 0.000652125, 0.000501933]